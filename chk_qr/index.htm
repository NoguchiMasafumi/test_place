<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.6.11/dist/dbr.js"></script>
</head>
<body>
2.5<br />
    <input type="file" id="u" accept="image/*">
    <p id="r">読み取り結果を待機中...</p>

    <script>
        // 体験版ライセンスキー（公開されている公式テスト用）
        Dynamsoft.DBR.BarcodeReader.license = 'DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAxLTE2NDk4Mjk3OTI2MzUiLCJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSIsInNlc3Npb25QYXNzd29yZCI6IndTc21nS0Z3S0RQayJ9';

        let reader = null;

        document.getElementById('u').onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const r = document.getElementById('r');
            r.innerText = "解析中...";

            try {
                // リーダーの初期化（初回のみ時間がかかります）
                reader = reader || await Dynamsoft.DBR.BarcodeReader.createInstance();
                
                // 読み取り設定をmicroPDF417に最適化
                let settings = await reader.getRuntimeSettings();
                settings.barcodeFormatIds = Dynamsoft.DBR.EnumBarcodeFormat.BF_MICRO_PDF417;
                await reader.updateRuntimeSettings(settings);

                // 解析実行
                const results = await reader.decode(file);

                if (results.length > 0) {
                    r.innerText = "読取成功: " + results[0].barcodeText;
                } else {
                    r.innerText = "コードが見つかりませんでした。";
                }
            } catch (err) {
                r.innerText = "エラー: " + err;
                console.error(err);
            }
        };
    </script>
</body>
</html>
