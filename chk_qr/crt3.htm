<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>MicroPDF417 Generator with Margin</title>
    <script src="https://unpkg.com/bwip-js/dist/bwip-js-min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        canvas { border: 1px solid #ccc; margin-top: 10px; }
    </style>
</head>
<body>
3.4<br />
    <input type="text" id="t" value="ABCDEFG">
    <button id="b">生成</button>
    <br><br>
    <canvas id="c"></canvas>
    <br><br>
    <button id="d" style="display:none;">JPGとして保存</button>

    <script>
        const t = document.getElementById('t');
        const c = document.getElementById('c');
        const b = document.getElementById('b');
        const d = document.getElementById('d');

        b.onclick = () => {
            if (!t.value) return;

            // bwipjsの呼び出し
            const generator = window.bwipjs || bwipjs;

            if (!generator) {
                alert("ライブラリがまだ読み込まれていません。再読み込みしてください。");
                return;
            }

            try {
                // toCanvasメソッドでオプションを指定
                generator.toCanvas(c, {
                    bcid: 'micropdf417',   // バーコードの種類
                    text: t.value,         // 入力データ
                    scale: 3,              // 拡大倍率
                    height: 10,            // バーの高さ
                    includetext: true,     // テキストを表示するか
                    backgroundcolor: 'FFFFFF', // 背景色を白に指定（重要）
                    
                    // --- 余白の設定 ---
                    paddingwidth: 15,      // 左右に15の余白（scale倍されます）
                    paddingheight: 15,     // 上下に15の余白（scale倍されます）
                });

                // 生成に成功したら保存ボタンを表示
                d.style.display = 'inline';
            } catch (e) {
                console.error(e);
                alert('生成エラー: ' + e);
            }
        };

        // 保存ボタンの処理
        d.onclick = () => {
            const link = document.createElement('a');
            link.download = 'micropdf417_with_margin.jpg';
            // canvasの内容をJPGデータに変換
            link.href = c.toDataURL('image/jpeg', 1.0);
            link.click();
        };
    </script>
</body>
</html>
