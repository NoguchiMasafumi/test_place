<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>PDF417 Generator with Margin</title>
    <script src="https://unpkg.com/bwip-js/dist/bwip-js-min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        canvas { border: 1px solid #ccc; margin-top: 10px; }
        .controls { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h2>PDF417 ジェネレーター</h2>
    <div class="controls">
        <input type="text" id="t" value="ABCDEFG" style="width: 300px;">
        <button id="b">生成</button>
    </div>
    
    <canvas id="c"></canvas>
    <br><br>
    <button id="d" style="display:none;">JPGとして保存</button>

    <script>
        const t = document.getElementById('t');
        const c = document.getElementById('c');
        const b = document.getElementById('b');
        const d = document.getElementById('d');

        b.onclick = () => {
            if (!t.value) return;

            const generator = window.bwipjs || bwipjs;

            if (!generator) {
                alert("ライブラリが読み込まれていません。");
                return;
            }

            try {
                // PDF417形式で描画
                generator.toCanvas(c, {
                    bcid: 'pdf417',         // ここを 'pdf417' に変更
                    text: t.value,         // 入力データ
                    scale: 2,              // PDF417は横に長くなりやすいため、scaleを少し調整
                    height: 12,            // 各行の高さ
                    includetext: false,    // PDF417は通常下にテキストを表示しないためfalseを推奨
                    backgroundcolor: 'FFFFFF',
                    
                    // --- 余白の設定 ---
                    paddingwidth: 10,      
                    paddingheight: 10,     
                });

                // 保存ボタンを表示
                d.style.display = 'inline';
            } catch (e) {
                console.error(e);
                alert('生成エラー: ' + e);
            }
        };

        // 保存ボタンの処理
        d.onclick = () => {
            const link = document.createElement('a');
            link.download = 'pdf417_output.jpg';
            link.href = c.toDataURL('image/jpeg', 1.0);
            link.click();
        };
    </script>
</body>
</html>
